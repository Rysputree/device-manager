openapi: 3.0.3
info:
  title: CTHz System 300 Device Management API (Internal)
  version: 0.1.0
  description: |
    Internal-only API specification for the System 300 Device Management (DM) service.

    Notes
    - This spec includes Spurtree-owned Device Management APIs and references CTHz-owned Sensor APIs (proxied by DM).
    - Do not expose Swagger/Redoc in production. Keep this file internal.

servers:
  - url: https://localhost:8443
    description: Local development (TLS)

security:
  - bearerAuth: []

x-rbac-roles:
  - owner
  - admin
  - monitor

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Error:
      type: object
      properties:
        code:
          type: string
          example: validation_error
        message:
          type: string
          example: Invalid request payload
        details:
          type: object
        requestId:
          type: string
          example: 9b2f9d62-4e1e-4a9b-95f1-3b9e0a9f3c1a
      required: [code, message]
    Ack:
      type: object
      properties:
        ok:
          type: boolean
          example: true
        message:
          type: string
    ID:
      type: object
      properties:
        id:
          type: string
          example: 123
    Pagination:
      type: object
      properties:
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [owner, admin, monitor]
        is_active:
          type: boolean
    Device:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        device_id: { type: string }
        serial_number: { type: string }
        ip_address: { type: string }
        status: { type: string, example: online }
    Station:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        device_ids: { type: array, items: { type: string } }
    Policy:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        is_system_policy: { type: boolean }
        is_active: { type: boolean }
        conditions: { type: object }
        actions: { type: array, items: { type: object } }

paths:
  # ==========================
  # Auth (Spurtree-owned)
  # ==========================
  /api/auth/login:
    post:
      tags: [auth]
      summary: User login authentication
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        '200':
          description: JWT tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token: { type: string }
                  refresh_token: { type: string }
        '401': { description: Unauthorized, content: { application/json: { schema: { $ref: '#/components/schemas/Error' } } } }
  /api/auth/logout:
    post:
      tags: [auth]
      summary: User logout
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
        '401': { description: Unauthorized }
  /api/auth/refresh:
    post:
      tags: [auth]
      summary: JWT token refresh
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token: { type: string }
      responses:
        '200': { description: New tokens, content: { application/json: { schema: { type: object, properties: { access_token: { type: string }, refresh_token: { type: string } } } } } }
        '401': { description: Unauthorized }
  /api/auth/setup:
    post:
      tags: [auth]
      summary: First-time setup (create Owner account)
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      x-rbac: [owner]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        '201': { description: Owner created, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
        '409': { description: Already initialized, content: { application/json: { schema: { $ref: '#/components/schemas/Error' } } } }
  /api/auth/me:
    get:
      tags: [auth]
      summary: Current user info
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Me, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
        '401': { description: Unauthorized }
    put:
      tags: [auth]
      summary: Update user profile
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
        '401': { description: Unauthorized }
  /api/auth/change-password:
    post:
      tags: [auth]
      summary: Change password
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                current_password: { type: string }
                new_password: { type: string }
      responses:
        '200': { description: Changed, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
        '400': { description: Weak password, content: { application/json: { schema: { $ref: '#/components/schemas/Error' } } } }
  /api/auth/users:
    get:
      tags: [auth]
      summary: List all users (Admin only)
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      x-rbac: [owner, admin]
      responses:
        '200': { description: Users, content: { application/json: { schema: { type: array, items: { $ref: '#/components/schemas/User' } } } } }
    post:
      tags: [auth]
      summary: Create new user (Admin only)
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      x-rbac: [owner, admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201': { description: Created, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
  /api/auth/users/{id}:
    get:
      tags: [auth]
      summary: Get user details
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        '200': { description: User, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
        '404': { description: Not found }
    put:
      tags: [auth]
      summary: Update user
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/User' }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
    delete:
      tags: [auth]
      summary: Delete user
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        '204': { description: Deleted }
  /api/auth/users/{id}/role:
    put:
      tags: [auth]
      summary: Change user role
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      x-rbac: [owner, admin]
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [owner, admin, monitor]
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }
  /api/auth/users/{id}/status:
    put:
      tags: [auth]
      summary: Enable/disable user
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      x-rbac: [owner, admin]
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                is_active: { type: boolean }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/User' } } } }

  # ==========================
  # Devices (Spurtree-owned)
  # ==========================
  /api/devices/discover:
    get:
      tags: [devices]
      summary: Scan network for CTHz devices using mDNS
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Discovered devices, content: { application/json: { schema: { type: array, items: { $ref: '#/components/schemas/Device' } } } } }
  /api/devices/pair:
    post:
      tags: [devices]
      summary: Pair with discovered device
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                device_id: { type: string }
                token: { type: string }
      responses:
        '201': { description: Paired, content: { application/json: { schema: { $ref: '#/components/schemas/Device' } } } }
  /api/devices/discovery/status:
    get:
      tags: [devices]
      summary: Discovery service status
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /api/devices:
    get:
      tags: [devices]
      summary: List managed devices
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Devices, content: { application/json: { schema: { type: array, items: { $ref: '#/components/schemas/Device' } } } } }
    post:
      tags: [devices]
      summary: Add device manually
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Device' }
      responses:
        '201': { description: Created, content: { application/json: { schema: { $ref: '#/components/schemas/Device' } } } }
  /api/devices/{id}:
    get:
      tags: [devices]
      summary: Get device details
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: Device, content: { application/json: { schema: { $ref: '#/components/schemas/Device' } } } }
        '404': { description: Not found }
    put:
      tags: [devices]
      summary: Update device info
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Device' }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/Device' } } } }
    delete:
      tags: [devices]
      summary: Remove device
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204': { description: Deleted }
  /api/devices/{id}/status:
    get:
      tags: [devices]
      summary: Device status summary (proxy to CTHz)
      x-owner: Spurtree
      x-proxy-owner: CTHz
      x-priority: High
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /api/devices/{id}/test-connection:
    post:
      tags: [devices]
      summary: Test device connectivity
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /api/devices/{id}/scan/start:
    post:
      tags: [devices]
      summary: Start scan on device (proxy to CTHz)
      x-owner: Spurtree
      x-proxy-owner: CTHz
      x-priority: High
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: false
      responses:
        '200': { description: Started, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /api/devices/{id}/scan/stop:
    post:
      tags: [devices]
      summary: Stop scan on device (proxy to CTHz)
      x-owner: Spurtree
      x-proxy-owner: CTHz
      x-priority: High
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: Stopped, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /api/devices/{id}/calibration/start:
    post:
      tags: [devices]
      summary: Start calibration (proxy to CTHz)
      x-owner: Spurtree
      x-proxy-owner: CTHz
      x-priority: High
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: Calibration started, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /api/devices/{id}/calibration/{cal_id}:
    get:
      tags: [devices]
      summary: Get calibration results (proxy to CTHz)
      x-owner: Spurtree
      x-proxy-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: cal_id
          required: true
          schema: { type: string }
      responses:
        '200': { description: Calibration result, content: { application/json: { schema: { type: object } } } }

  # ==========================
  # Stations (Spurtree-owned)
  # ==========================
  /api/stations:
    get:
      tags: [stations]
      summary: List all stations
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Stations, content: { application/json: { schema: { type: array, items: { $ref: '#/components/schemas/Station' } } } } }
    post:
      tags: [stations]
      summary: Create new station
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Station' }
      responses:
        '201': { description: Created, content: { application/json: { schema: { $ref: '#/components/schemas/Station' } } } }
  /api/stations/{id}:
    get:
      tags: [stations]
      summary: Get station details
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Station, content: { application/json: { schema: { $ref: '#/components/schemas/Station' } } } }
        '404': { description: Not found }
    put:
      tags: [stations]
      summary: Update station
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Station' }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/Station' } } } }
    delete:
      tags: [stations]
      summary: Delete station
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '204': { description: Deleted }
  /api/stations/{id}/status:
    get:
      tags: [stations]
      summary: Aggregated station status
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /api/stations/{id}/devices:
    post:
      tags: [stations]
      summary: Add device to station
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                device_id: { type: string }
      responses:
        '200': { description: Added, content: { application/json: { schema: { $ref: '#/components/schemas/Station' } } } }
  /api/stations/{id}/devices/{device_id}:
    delete:
      tags: [stations]
      summary: Remove device from station
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters:
        - { in: path, name: id, required: true, schema: { type: string } }
        - { in: path, name: device_id, required: true, schema: { type: string } }
      responses:
        '200': { description: Removed, content: { application/json: { schema: { $ref: '#/components/schemas/Station' } } } }

  # ==========================
  # Policies (Spurtree-owned)
  # ==========================
  /api/policies:
    get:
      tags: [policies]
      summary: List all policies
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Policies, content: { application/json: { schema: { type: array, items: { $ref: '#/components/schemas/Policy' } } } } }
    post:
      tags: [policies]
      summary: Create new policy
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Policy' }
      responses:
        '201': { description: Created, content: { application/json: { schema: { $ref: '#/components/schemas/Policy' } } } }
  /api/policies/{id}:
    get:
      tags: [policies]
      summary: Get policy details
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Policy, content: { application/json: { schema: { $ref: '#/components/schemas/Policy' } } } }
        '404': { description: Not found }
    put:
      tags: [policies]
      summary: Update policy
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Policy' }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/Policy' } } } }
    delete:
      tags: [policies]
      summary: Delete policy (non-system only)
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '204': { description: Deleted }
  /api/policies/{id}/status:
    put:
      tags: [policies]
      summary: Enable/disable policy
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                is_active: { type: boolean }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/Policy' } } } }

  # ==========================
  # Configuration (Spurtree-owned)
  # ==========================
  /api/config/devices/{id}:
    get:
      tags: [config]
      summary: Get all device configuration
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Config, content: { application/json: { schema: { type: object } } } }
    put:
      tags: [config]
      summary: Update device configuration
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
    patch:
      tags: [config]
      summary: Partial configuration update
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /api/config/devices/{id}/validate:
    post:
      tags: [config]
      summary: Validate configuration before applying
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Validation result, content: { application/json: { schema: { type: object } } } }

  # ==========================
  # Monitoring & Alerts (Spurtree-owned)
  # ==========================
  /api/monitoring/dashboard:
    get:
      tags: [monitoring]
      summary: Dashboard summary data
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Summary, content: { application/json: { schema: { type: object } } } }
  /api/monitoring/devices:
    get:
      tags: [monitoring]
      summary: All devices status
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: array, items: { type: object } } } } }
  /api/monitoring/devices/{id}:
    get:
      tags: [monitoring]
      summary: Individual device status
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /api/monitoring/stations:
    get:
      tags: [monitoring]
      summary: All stations status
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: array, items: { type: object } } } } }
  /api/monitoring/stations/{id}:
    get:
      tags: [monitoring]
      summary: Individual station status
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /api/monitoring/system:
    get:
      tags: [monitoring]
      summary: System-wide metrics
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Metrics, content: { application/json: { schema: { type: object } } } }
  /api/monitoring/alerts:
    get:
      tags: [monitoring]
      summary: Active alerts
      x-owner: Spurtree
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Alerts, content: { application/json: { schema: { type: array, items: { type: object } } } } }
  /api/monitoring/alerts/{id}/acknowledge:
    put:
      tags: [monitoring]
      summary: Acknowledge alert
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Acknowledged, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }

  # ==========================
  # Audit (Spurtree-owned)
  # ==========================
  /api/audit/logs:
    get:
      tags: [audit]
      summary: Audit log entries
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Logs, content: { application/json: { schema: { type: array, items: { type: object } } } } }

  # ==========================
  # Integrations (Spurtree-owned)
  # ==========================
  /api/integrations/vms:
    get:
      tags: [integrations]
      summary: List VMS integrations
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: VMS list, content: { application/json: { schema: { type: array, items: { type: object } } } } }
    post:
      tags: [integrations]
      summary: Add VMS integration
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '201': { description: Created, content: { application/json: { schema: { type: object } } } }
  /api/integrations/vms/{id}:
    get:
      tags: [integrations]
      summary: Get VMS config
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      responses:
        '200': { description: VMS config, content: { application/json: { schema: { type: object } } } }
    put:
      tags: [integrations]
      summary: Update VMS config
      x-owner: Spurtree
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: id, required: true, schema: { type: string } }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }

  /api/integrations/biometric:
    get:
      tags: [integrations]
      summary: Get biometric config
      x-owner: Spurtree
      x-priority: Low
      x-phase: MVP
      responses:
        '200': { description: Biometric config, content: { application/json: { schema: { type: object } } } }
    put:
      tags: [integrations]
      summary: Update biometric config
      x-owner: Spurtree
      x-priority: Low
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }

  # ==========================
  # CTHz Sensor APIs (for reference; proxied by DM)
  # ==========================
  /health:
    get:
      tags: [sensor]
      summary: Basic health check (5s timeout)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Healthy, content: { application/json: { schema: { type: object } } } }
  /device-info:
    get:
      tags: [sensor]
      summary: Static device information
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Info, content: { application/json: { schema: { type: object } } } }
  /status:
    get:
      tags: [sensor]
      summary: Current operational status
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /system/metrics:
    get:
      tags: [sensor]
      summary: Performance metrics
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Metrics, content: { application/json: { schema: { type: object } } } }
  /system/diagnostics:
    get:
      tags: [sensor]
      summary: Diagnostic information
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Diagnostics, content: { application/json: { schema: { type: object } } } }
  /scan/start:
    post:
      tags: [sensor]
      summary: Initiate scan
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Started, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /scan/stop:
    post:
      tags: [sensor]
      summary: Stop current scan
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Stopped, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /scan/current:
    get:
      tags: [sensor]
      summary: Current scan status
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Scan status, content: { application/json: { schema: { type: object } } } }
  /scans/{scan_id}:
    get:
      tags: [sensor]
      summary: Get scan results by ID
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      parameters: [{ in: path, name: scan_id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Scan, content: { application/json: { schema: { type: object } } } }
  /scans/recent:
    get:
      tags: [sensor]
      summary: Recent scans with filters
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Scans, content: { application/json: { schema: { type: array, items: { type: object } } } } }
  /calibration/start:
    post:
      tags: [sensor]
      summary: Start calibration
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Calibration started, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /calibration/{calibration_id}:
    get:
      tags: [sensor]
      summary: Get calibration results
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      parameters: [{ in: path, name: calibration_id, required: true, schema: { type: string } }]
      responses:
        '200': { description: Calibration, content: { application/json: { schema: { type: object } } } }
  /calibration/status:
    get:
      tags: [sensor]
      summary: Current calibration status
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Status, content: { application/json: { schema: { type: object } } } }
  /motion/status:
    get:
      tags: [sensor]
      summary: Motion detection status
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Motion status, content: { application/json: { schema: { type: object } } } }
  /motion/config:
    put:
      tags: [sensor]
      summary: Configure motion settings
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/image-buffer:
    post:
      tags: [sensor]
      summary: Set pre-scan buffer
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                seconds: { type: integer, example: 15 }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /motion/trigger-scan:
    post:
      tags: [sensor]
      summary: Manual motion trigger (testing)
      x-owner: CTHz
      x-priority: Low
      x-phase: MVP
      responses:
        '200': { description: Triggered, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /config/network:
    get:
      tags: [sensor]
      summary: Current network config
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Network config, content: { application/json: { schema: { type: object } } } }
  /config/network/wifi:
    put:
      tags: [sensor]
      summary: WiFi settings (CFG-002)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/network/ethernet:
    put:
      tags: [sensor]
      summary: LAN settings (CFG-003)
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/device:
    get:
      tags: [sensor]
      summary: Device configuration
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      responses:
        '200': { description: Config, content: { application/json: { schema: { type: object } } } }
  /config/device/info:
    put:
      tags: [sensor]
      summary: Basic device info (CFG-001)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/device/gps:
    put:
      tags: [sensor]
      summary: GPS settings (CFG-006)
      x-owner: CTHz
      x-priority: Low
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/device/ntp:
    put:
      tags: [sensor]
      summary: NTP settings (CFG-012)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/detection/parameters:
    put:
      tags: [sensor]
      summary: CTHz 3D parameters (CFG-017)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/detection/sensitivity:
    put:
      tags: [sensor]
      summary: Detection sensitivity
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/storage:
    put:
      tags: [sensor]
      summary: Storage settings (CFG-008)
      x-owner: CTHz
      x-priority: High
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/heartbeat:
    put:
      tags: [sensor]
      summary: Heartbeat settings (CFG-013)
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /config/media:
    put:
      tags: [sensor]
      summary: Video/Audio settings (CFG-015)
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated, content: { application/json: { schema: { type: object } } } }
  /system/restart:
    post:
      tags: [sensor]
      summary: Restart sensor system
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Restarting, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }
  /system/logs:
    get:
      tags: [sensor]
      summary: System/diagnostic logs
      x-owner: CTHz
      x-priority: Medium
      x-phase: MVP
      responses:
        '200': { description: Logs, content: { application/json: { schema: { type: array, items: { type: string } } } } }
  /system/firmware/update:
    post:
      tags: [sensor]
      summary: Firmware update
      x-owner: CTHz
      x-priority: Low
      x-phase: Phase1
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '202': { description: Update queued, content: { application/json: { schema: { $ref: '#/components/schemas/Ack' } } } }

# End of file 